# This workflow reads a CSV file and outputs to another CSV file, filter out
# all records that do not match the criteria.
#
# Example command-line usage:
# kurator -f text_file_splitter.yaml -p fullpath=../../data/eight_specimen_records.csv -p chunksize=5 -p workspace=./

imports:

- classpath:/org/kurator/akka/actors.yaml
- classpath:/org/kurator/validation/actors/dwca/actors.yaml

components:

- id: DWCAtoTSVWriter
  type: PythonActor
  properties:
    script: dwca_core_to_tsv.py
    onStart: dwca_core_to_tsv
    parameters:
      outputTypeIsInputType: true

- id: TextFileSplitter
  type: PythonActor
  properties:
    script: text_file_splitter.py
    onStart: text_file_splitter
    listensTo:
      - !ref DWCAtoTSVWriter
    parameters:
      outputTypeIsInputType: true

- id: DWCASplitWorkflow
  type: Workflow
  properties:
    actors:
      - !ref DWCAtoTSVWriter
      - !ref TextFileSplitter
    parameters:
      dwcafile:
        actor: !ref DWCAtoTSVWriter
        parameter: inputfile
      dwcatsvfile:
        actor: !ref DWCAtoTSVWriter
        parameter: outputfile
      dwcatype:
        actor: !ref DWCAtoTSVWriter
        parameter: type
      fullpath:
        actor: !ref TextFileSplitter
        parameter: fullpath
      chunksize:
        actor: !ref TextFileSplitter
        parameter: chunksize
      workspace:
        actor: !ref TextFileSplitter
        parameter: workspace
